"use strict";L.DomUtil.setTransform||(L.DomUtil.setTransform=function(t,e,n){var i=e||new L.Point(0,0);t.style[L.DomUtil.TRANSFORM]=(L.Browser.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")}),L.CanvasLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(t){this._map=null,this._canvas=null,this._frame=null,this._delegate=null,L.setOptions(this,t)},delegate:function(t){return this._delegate=t,this},needRedraw:function(){return this._frame||(this._frame=L.Util.requestAnimFrame(this.drawLayer,this)),this},_onLayerDidResize:function(t){this._canvas.width=t.newSize.x,this._canvas.height=t.newSize.y},_onLayerDidMove:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t),this.drawLayer()},getEvents:function(){var t={resize:this._onLayerDidResize,moveend:this._onLayerDidMove};return this._map.options.zoomAnimation&&L.Browser.any3d&&(t.zoomanim=this._animateZoom),t},onAdd:function(t){this._map=t,this._canvas=L.DomUtil.create("canvas","leaflet-layer"),this.tiles={};var e=this._map.getSize();this._canvas.width=e.x,this._canvas.height=e.y;var n=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(this._canvas,"leaflet-zoom-"+(n?"animated":"hide")),t._panes.overlayPane.appendChild(this._canvas),t.on(this.getEvents(),this);var i=this._delegate||this;i.onLayerDidMount&&i.onLayerDidMount(),this.needRedraw();var o=this;setTimeout(function(){o._onLayerDidMove()},0)},onRemove:function(t){var e=this._delegate||this;e.onLayerWillUnmount&&e.onLayerWillUnmount(),t.getPanes().overlayPane.removeChild(this._canvas),t.off(this.getEvents(),this),this._canvas=null},addTo:function(t){return t.addLayer(this),this},LatLonToMercator:function(t){return{x:6378137*t.lng*Math.PI/180,y:6378137*Math.log(Math.tan((90+t.lat)*Math.PI/360))}},drawLayer:function(){var t=this._map.getSize(),e=this._map.getBounds(),n=this._map.getZoom(),i=this.LatLonToMercator(this._map.getCenter()),o=this.LatLonToMercator(this._map.containerPointToLatLng(this._map.getSize())),a=this._delegate||this;a.onDrawLayer&&a.onDrawLayer({layer:this,canvas:this._canvas,bounds:e,size:t,zoom:n,center:i,corner:o}),this._frame=null},_setTransform:function(t,e,n){var i=e||new L.Point(0,0);t.style[L.DomUtil.TRANSFORM]=(L.Browser.ie3d?"translate("+i.x+"px,"+i.y+"px)":"translate3d("+i.x+"px,"+i.y+"px,0)")+(n?" scale("+n+")":"")},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=L.Layer?this._map._latLngToNewLayerPoint(this._map.getBounds().getNorthWest(),t.zoom,t.center):this._map._getCenterOffset(t.center)._multiplyBy(-e).subtract(this._map._getMapPanePos());L.DomUtil.setTransform(this._canvas,n,e)}}),L.canvasLayer=function(){return new L.CanvasLayer},L.Control.Velocity=L.Control.extend({options:{position:"bottomleft",emptyString:"Unavailable",angleConvention:"bearingCCW",speedUnit:"m/s"},onAdd:function(t){return this._container=L.DomUtil.create("div","leaflet-control-velocity"),L.DomEvent.disableClickPropagation(this._container),t.on("mousemove",this._onMouseMove,this),this._container.innerHTML=this.options.emptyString,this._container},onRemove:function(t){t.off("mousemove",this._onMouseMove,this)},vectorToSpeed:function(t,e,n){var i=Math.sqrt(Math.pow(t,2)+Math.pow(e,2));return"k/h"===n?this.meterSec2kilometerHour(i):"kt"===n?this.meterSec2Knots(i):i},vectorToDegrees:function(t,e,n){n.endsWith("CCW")&&(e=0<e?e=-e:Math.abs(e));var i=Math.sqrt(Math.pow(t,2)+Math.pow(e,2)),o=180*Math.atan2(t/i,e/i)/Math.PI+180;return"bearingCW"!==n&&"meteoCCW"!==n||360<=(o+=180)&&(o-=360),o},meterSec2Knots:function(t){return t/.514},meterSec2kilometerHour:function(t){return 3.6*t},_onMouseMove:function(t){var e=this.options.leafletVelocity._map.containerPointToLatLng(L.point(t.containerPoint.x,t.containerPoint.y)),n=this.options.leafletVelocity._windy.interpolatePoint(e.lng,e.lat),i="";i=n&&!isNaN(n[0])&&!isNaN(n[1])&&n[2]?"<strong>"+this.options.velocityType+" Direction: </strong>"+this.vectorToDegrees(n[0],n[1],this.options.angleConvention).toFixed(2)+"Â°, <strong>"+this.options.velocityType+" Speed: </strong>"+this.vectorToSpeed(n[0],n[1],this.options.speedUnit).toFixed(2)+this.options.speedUnit:this.options.emptyString,this._container.innerHTML=i,0==$(".leaflet-control-velocity").index()&&$(".leaflet-control-velocity").insertAfter(".leaflet-control-mouseposition")}}),L.Map.mergeOptions({positionControl:!1}),L.Map.addInitHook(function(){this.options.positionControl&&(this.positionControl=new L.Control.MousePosition,this.addControl(this.positionControl))}),L.control.velocity=function(t){return new L.Control.Velocity(t)},L.VelocityLayer=(L.Layer?L.Layer:L.Class).extend({options:{displayValues:!0,displayOptions:{velocityType:"Velocity",position:"bottomleft",emptyString:"No velocity data"},maxVelocity:10,colorScale:null,data:null},_map:null,_canvasLayer:null,_windy:null,_context:null,_timer:0,_mouseControl:null,initialize:function(t){L.setOptions(this,t)},onAdd:function(t){this._canvasLayer=L.canvasLayer().delegate(this),this._canvasLayer.addTo(t),this._map=t},onRemove:function(t){this._destroyWind()},setData:function(t){this.options.data=t,this._windy&&(this._windy.setData(t),this._Restart()),this.fire("load")},onDrawLayer:function(t,e){var n=this;this._windy?this.options.data&&(this._timer&&clearTimeout(n._timer),this._timer=setTimeout(function(){n._startWindy()},750)):this._initWindy(this)},_startWindy:function(){var t=this._map.getBounds(),e=this._map.getSize();this._windy.start([[0,0],[e.x,e.y]],e.x,e.y,[[t._southWest.lng,t._southWest.lat],[t._northEast.lng,t._northEast.lat]])},_initWindy:function(t){var e=Object.assign({canvas:t._canvasLayer._canvas},t.options);this._windy=new Windy(e),this._context=this._canvasLayer._canvas.getContext("2d"),this._canvasLayer._canvas.classList.add("velocity-overlay"),this.onDrawLayer(),this._map.on("dragstart",t._windy.stop),this._map.on("dragend",t._clearAndRestart),this._map.on("zoomstart",t._windy.stop),this._map.on("zoomend",t._clearAndRestart),this._map.on("resize",t._clearWind),this._initMouseHandler()},_initMouseHandler:function(){if(!this._mouseControl&&this.options.displayValues){var t=this.options.displayOptions||{};(t.leafletVelocity=this)._mouseControl=L.control.velocity(t).addTo(this._map)}},_clearAndRestart:function(){this._context&&this._context.clearRect(0,0,3e3,3e3),this._windy&&this._startWindy()},_Restart:function(){this._windy&&this._startWindy()},_clearWind:function(){this._windy&&this._windy.stop(),this._context&&this._context.clearRect(0,0,3e3,3e3)},_destroyWind:function(){this._timer&&clearTimeout(this._timer),this._windy&&this._windy.stop(),this._context&&this._context.clearRect(0,0,3e3,3e3),this._mouseControl&&this._map.removeControl(this._mouseControl),this._mouseControl=null,this._windy=null,this._map.removeLayer(this._canvasLayer)}}),L.velocityLayer=function(t){return new L.VelocityLayer(t)};var Windy=function(d){var m,y,_,p,f,v,g,L,M,w,x=d.minVelocity||0,C=d.maxVelocity||10,b=(d.velocityScale||.005)*(Math.pow(window.devicePixelRatio,1/3)||1),T=d.particleAge||90,D=d.lineWidth||1,P=d.particleMultiplier||1/300,z=Math.pow(window.devicePixelRatio,1/3)||1.6,S=1e3/(d.frameRate||15),W=d.colorScale||["rgb(36,104, 180)","rgb(60,157, 194)","rgb(128,205,193 )","rgb(151,218,168 )","rgb(198,231,181)","rgb(238,247,217)","rgb(255,238,159)","rgb(252,217,125)","rgb(255,182,100)","rgb(252,150,75)","rgb(250,112,52)","rgb(245,64,32)","rgb(237,45,28)","rgb(220,24,32)","rgb(180,0,35)"],r=[NaN,NaN,null],e=d.data,s=function(t,e,n,i,o,a){var r=1-t,s=1-e,h=r*s,l=t*s,c=r*e,u=t*e,d=n[0]*h+i[0]*l+o[0]*c+a[0]*u,m=n[1]*h+i[1]*l+o[1]*c+a[1]*u;return[d,m,Math.sqrt(d*d+m*m)]},R=function(t){var e,n,i,o,a=null,r=null;return t.forEach(function(t){switch(t.header.parameterCategory+","+t.header.parameterNumber){case"1,2":case"2,2":a=t;break;case"1,3":case"2,3":r=t;break;default:t}}),n=r,i=(e=a).data,o=n.data,{header:e.header,data:function(t){return[i[t],o[t]]},interpolate:s}},A=function(t,e){if(!y)return null;var n,i=N(t-p,360)/v,o=(f-e)/g,a=Math.floor(i),r=a+1,s=Math.floor(o),h=s+1;if(n=y[s]){var l=n[a],c=n[r];if(U(l)&&U(c)&&(n=y[h])){var u=n[a],d=n[r];if(U(u)&&U(d))return m.interpolate(i-a,o-s,l,c,u,d)}}return null},U=function(t){return null!=t},N=function(t,e){return t-e*Math.floor(t/e)},F=function(t,e,n,i,o,a){var r=2*Math.PI,s=Math.pow(10,-5.2),h=e<0?s:-s,l=n<0?s:-s,c=I(n,e+h,a),u=I(n+l,e,a),d=Math.cos(n/360*r);return[(c[0]-i)/h/d,(c[1]-o)/h/d,(u[0]-i)/l,(u[1]-o)/l]},V=function(i,o,t){function a(t,e){var n=i[Math.round(t)];return n&&n[Math.round(e)]||r}a.release=function(){i=[]},a.randomize=function(t){for(var e,n,i=0;null===a(e=Math.round(Math.floor(Math.random()*o.width)+o.x),n=Math.round(Math.floor(Math.random()*o.height)+o.y))[2]&&i++<30;);return t.x=e,t.y=n,t},t(o,a)},k=function(t){return t/180*Math.PI},E=function(t){return t/(Math.PI/180)},h=function(t){return Math.log(Math.tan(t/2+Math.PI/4))},I=function(t,e,n){var i=h(n.south),o=h(n.north),a=n.width/(n.east-n.west),r=n.height/(o-i),s=h(k(t));return[(k(e)-n.west)*a,s=(o-s)*r]},O=function(i,s,t){var e,n,h=(e=x,n=C,W.indexFor=function(t){return Math.max(0,Math.min(W.length-1,Math.round((t-e)/(n-e)*(W.length-1))))},W),l=h.map(function(){return[]}),o=Math.round(i.width*i.height*P);/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i.test(navigator.userAgent)&&(o*=z);for(var a=[],r=0;r<o;r++)t.length?a.push(t.shift()):a.push(s.randomize({age:Math.floor(Math.random()*T)+0}));var c=d.canvas.getContext("2d");c.lineWidth=D,c.fillStyle="rgba(0, 0, 0, 0.97)",c.globalAlpha=.6;var u=0;return function t(){w=requestAnimationFrame(t);var e=Date.now(),n=e-u;S<n&&(u=e-n%S,l.forEach(function(t){t.length=0}),a.forEach(function(t){t.age>T&&(s.randomize(t).age=0);var e=t.x,n=t.y,i=s(e,n),o=i[2];if(null===o)t.age=T;else{var a=e+i[0],r=n+i[1];null!==s(a,r)[2]?(t.xt=a,t.yt=r,l[h.indexFor(o)].push(t)):(t.x=a,t.y=r)}t.age+=1}),c.globalCompositeOperation="destination-in",c.fillRect(i.x,i.y,i.width,i.height),c.globalCompositeOperation="lighter",c.globalAlpha=.9,l.forEach(function(t,e){0<t.length&&(c.beginPath(),c.strokeStyle=h[e],t.forEach(function(t){c.moveTo(t.x,t.y),c.lineTo(t.xt,t.yt),t.x=t.xt,t.y=t.yt}),c.stroke())}))}(),a},H=function(){B.field&&B.field.release(),w&&cancelAnimationFrame(w)},B={params:d,start:function(h,l,c,t){var u={south:k(t[0][1]),north:k(t[1][1]),east:k(t[1][0]),west:k(t[0][0]),width:l,height:c};(new Date).getTime();!function(t,e){var n=(m=R(t)).header;p=n.lo1,f=n.la1,v=n.dx,g=n.dy,L=n.nx,M=n.ny,(_=new Date(n.refTime)).setHours(_.getHours()+n.forecastTime),y=[];for(var i=0,o=360<=Math.floor(L*v),a=0;a<M;a++){for(var r=[],s=0;s<L;s++,i++)r[s]=m.data(i);o&&r.push(r[0]),y[a]=r}e({date:_,interpolate:A})}(e,function(t){var e,n,i,o,a,r,s;!function(T,D,P,n){var z={},t=(P.south-P.north)*(P.west-P.east),S=b*Math.pow(t,.4),W=[],i=D.x;function o(t){for(var e,n,i,o,a,r,s,h,l,c,u,d,m,y,_,p,f,v,g,L=[],M=D.y;M<=D.yMax;M+=2){var w=(d=t,m=M,_=(y=P).east-y.west,p=y.width/E(_)*360/(2*Math.PI),f=p/2*Math.log((1+Math.sin(y.south))/(1-Math.sin(y.south))),v=(y.height+f-m)/p,g=180/Math.PI*(2*Math.atan(Math.exp(v))-Math.PI/2),[E(y.west)+d/y.width*E(_),g]),x=w[0],C=w[1];if(isFinite(x)){var b=T.interpolate(x,C);b&&(e=z,n=x,i=C,o=t,a=M,r=S,h=P,l=(s=b)[0]*r,c=s[1]*r,u=F(e,n,i,o,a,h),s[0]=u[0]*l+u[2]*c,s[1]=u[1]*l+u[3]*c,b=s,L[M+1]=L[M]=b)}}W[t+1]=W[t]=L}!function t(){for(var e=Date.now();i<D.width;)if(o(i),i+=2,10<Date.now()-e)return void setTimeout(t,0);V(W,D,n)}()}(t,(n=l,i=c,o=(e=h)[0],a=e[1],r=Math.round(o[0]),s=Math.max(Math.floor(o[1],0),0),Math.min(Math.ceil(a[0],n),n-1),{x:r,y:s,xMax:n,yMax:Math.min(Math.ceil(a[1],i),i-1),width:n,height:i}),u,function(t,e){H(),B.field=e,B.particles=O(t,e,B.particles)})})},stop:H,createField:V,interpolatePoint:A,setData:function(t){e=t},particles:[]};return B};window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});